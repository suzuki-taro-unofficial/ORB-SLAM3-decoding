# やったこと

## 全体

今回も環境構築寄り。

- 八巻のPCでの動作確認をしたところ、MapViewerのなかでsegmentation faultが起きる。
- 藤原がOSをubuntu 18.04に変更し依存関係をORB_SLAM3の推奨に変更して試したところ、終了時のsegmentation faultが起こらなかった。
- これらを踏まえ、現在Dockerで18.04のubuntuで動作確認をしている。
  - いろんな問題にあたってまだ未完了
- CMakeファイルの大幅見直しをするなどして、モダンなCMakeになった。
  - サードパーティの個別ビルドをしていた部分などがまとまり、だいぶ見通しが良くなった
- ビルド以外にも、exampleの実行スクリプトなどを用意し、これからの作業をやりやすくした。

リファクタリング周り

- コンフィグのデータ形式が、1.0以前と以後で変わっており、その後方互換のためのコードが多く残っていた。
  - example-oldの方で使われる
  - これを削除して、1.0以降のみ対応としてコードの大幅削減

## kato

- Docker周りの整備・検証
- リーディング
  - CreateNewMapPointsについて
    - 冒頭あたりで、GetBestCovisibilityKeyFramesを使ってCovisibilityGraph上でつながったKFを探している。
    - その後、currentKFのprevKFを探索していって、GetBestCovisibilityKeyFramesの結果に含まれていたら、GetBestCovisibilityKeyFramesの結果にKF（prevKF）を加えている。
    - つまり、同一のKFをvector上に入れている。
    - ちょっとよくわからない。
  - KeyFrame.mPrevKFについて
    - マップが途切れると、mPrevKFも途切れる

## fujiwara

Trackingはどうしても必要になったら読むことにしたので、今週は開発環境周りの整備を行った

1. CMakeListsの中身を整理した
   - 以前はルート直下のCMakeListsにすべてを記述していたので、各ディレクトリにそれ用の処理を分けて書いた
2. 古い設定の読み込みコードを削除した
   - v1.0とそれ以前で設定ファイルの形式が異なっており、それぞれに対応させるために古いコードと新しいコードが同居していた
   - Example_oldを消去したことで古いコードは必要なくなったので、それを削除してコードの見通しを良くした
3. Dockerfileを追加して、各操作をmakeを起点に行えるようにした
   - 環境の差異で実行結果が異なっていたので、加藤君のDockerfileを元に環境を構築できるスクリプトを書いて、makeを用いて動作させる方式にした
   - 具体的には、 `make dev` でdockerの環境構築と実行を行い、docker内で `make build` や `make run` を行うことでビルドと実行ができるようにした

## yamaki

環境構築は他の二名に任せて、LoopClosingのコードリーディングおよび、リファクタリングを行った

1. リファクタリング

- 不要な変数の削除

2. リーディング

- ループやマージの検出の実行順序が不自然に見えたので、検出周りの動作を確認した。
  - マージ行なわれた場合ループの検出は消されるが、ループとマージの検出を同時に行う必要があるのか
  - Sim3は一致するKFが見つかっていなければ、そもそも検出を行なわないが、Sim3→BoWの検出順で正しいのか。
- 検出について、元の実装で問題ないことが分かった。
  - BoWの前処理を同時にやるので、同時に検出した方が効率が良い
  - Sim3は前回の過去のKFと一致が見られたKFと今回のKFについてSim3変換を行い一致するかみるため、今の順序で問題ない。
- 今はマージの処理について読み始めている。
