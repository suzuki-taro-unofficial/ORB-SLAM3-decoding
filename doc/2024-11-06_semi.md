# 2024-11-06 報告会

## 全体

- 環境構築
  - Dockerの環境構築が完了
    - Docker内で実行してローカルの画面に反映されることを確認
    - SSH越しでもOK
  - 画面出力のなかったサンプルを修正し、画面出力できるように
  - ビルド時間短縮のための検証
    - ヘッダファイルの相互参照を解消（効果はあまりなかった
    - ファイルを分割してみる（より長くなってしまったので戻した
      - ヘッダオンリーライブラリを呼び出すファイル毎にそのヘッダをコンパイルして遅くなった？
- リーディング・リファクタ
  - 各自担当箇所のリーディングとリファクタリング

## KATO

やったこと

- LocalMappingのリーディングとリファクタ
  - メンバ変数の意味や使用箇所の精査
    - unusedなメンバを削除
    - もう少し進めて、外部で読みとる必要のあるCellやStreamを精査したい。
      - こないだの大雑把なネットワークではなくもう少し詳しいネットワーク設計を進める
- Docker周りの作業
  - SSH & Docker越しX11転送とか

相談

- Debugのためのファイル出力機能を一旦消してしまうか迷っている
  - これを消した場合にunusedになるメンバが多く存在する
  - FRP化する際にデバッグの方法も異なってくるので、改造ではなく作り直すことになりそう
  - 今現在この機能は使われていない
  - そもそもDebugようでありSLAMに必須の機能というわけではない
- 別PCなど使える物があればほしい
  - Dockerの中に変えたせいか、ビルドに21分程かかる。
  - メモリが8GBしか無いため、並列ビルドも 2, 3 並列程度しかできない。
  - 16GBあると4並列でビルドできるはずなので、単純計算で倍速になる。

## FUJIWARA

### やったこと

前回に引き続き環境を整備し、ソースコード周りにも少し手を付けた

1. DockerでX11転送ができるようにした
   - 以前の環境ではExamplesの立ち上げ時にX11転送で失敗して動かせなかった
   - 大本先輩の助けを借りてDockerからX11転送をできるようにスクリプトを改修した
2. Examplesのコードを整備した
   - いくつかのコードでViewerを立ち上げてなかったので、立ち上げるようにした
   - これで、基本的には（EuRoCに関しては）すべての例を実行できるようになった
3. includeの整備
   - 現在のソースコードでは前方参照をしたうえでそのクラスのヘッダファイルの読み込みを行っている箇所があった
   - LSPがエラーを出すなどコードを読むうえで不都合があったので一度ヘッダファイルの整理を行った
   - また、CMakeListsでルートディレクトリをヘッダディレクトリとして読み込んでいたので、includeディレクトリとThirdparty下の各ディレクトリのみを読み込むようにした
4. ソースコード周りの改修
   - 未使用のクラスの削除を行った
   - LocalMappingで一部読めていないコードが合ったので、そのコードの解読とリファクタリングを行った

### 相談

ソースコードを読むうえで、動いているが想定とは違う動作を行っているであろう箇所がいくつか見つかった。例えばInitializeIMUにおいて

1. FullInertialBAが行われた際に行われるべき処理が常に実行されている
   - これは、現段階ではInitializeIMU自体が常にFullInertialBAを行っているため特に不具合は起きていない
2. キーフレームをキューから取り出して処理を行いベクタに格納した後に、キューの中身を削除している
   - 少なくともキーフレームが終了時までどこにも所属せず残り続けるだけで実害はなさそう

という箇所があった。他の担当場所でも同様のコードが見つかっており、果たしてそれを直すべきかそのままにするべきか迷っている

## YAMAKI

### やったこと

1. MergeLocal（IMUを使用していないときのマージ処理）のリーディングおよびリファクター

### 相談

1. MergeLocal2（IMUを使用しているときのマージ処理）が、今持っているExamplesではIMU使用するとマージが発生しない
   - 慣性データを使用すると、複数のマップが必要になるほどマップが壊れないためだと考えている。
   - そのためMergeLocal2が上手く動作しているか今持っているExamplesを動かすだけではテストができない
2. MergeLocalで本来やりたそうな動作と違う動作をしている部分があり、それを直すべきか
   - Mergeに使われるキーフレームやマップポイントをローカルのセットに挿入する動作の一部が、慣性データを持っているときにしか動かない。
     - MergeLocalは慣性データを持っていないときにしか動かないので、途中でセンサーが変わるようなことがない限りこの動作は動かない。
     - 今の実装では、途中でセンサーが変わるということはないので、この動作は絶対に行なわれない。
     - 挿入の方法も無限ループが発生しうるコード。
